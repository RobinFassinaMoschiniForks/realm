---
title: Tavern
tags: 
 - Dev Guide
description: Want to contribute to Tavern? Start here!
permalink: dev-guide/tavern
---
# Overview
![/assets/img/coming-soon.gif](/assets/img/coming-soon.gif)

# Configuration
## MySQL
By default, Tavern operates an in-memory SQLite database. To persist data, a MySQL backend is supported. In order to configure Tavern to use MySQL, the `MYSQL_ADDR` environment variable must be set to the `host[:port]` of the database (e.g. `127.0.0.1`, `mydb.com`, or `mydb.com:3306`). You can reference the [mysql.Config](https://pkg.go.dev/github.com/go-sql-driver/mysql#Config) for additional information about Tavern's MySQL configuration. 

The following environment variables are currently supported for additional MySQL Configuration:

| Env Var | Description | Default | Required |
| ------- | ----------- | ------- | -------- |
| MYSQL_ADDR| Address of the MySQL server (e.g. `host[:port]`) | N/A | **_Yes_** |
| MYSQL_NET| Network type (e.g. unix) | tcp | No |
| MYSQL_USER| User to authenticate with | root | No |
| MYSQL_PASSWD| Password to authenticate with | no password | No |
| MYSQL_DB| Name of the database to use | tavern | No |

<br/>
Here is an example of running Tavern locally with a MySQL backend:
```
MYSQL_USER="admin" MYSQL_ADDR="127.0.0.1:3306" go run ./tavern
```
<br/>
When no value is set for `MYSQL_ADDR`, the default SQLite backend is used:
```
MYSQL_USER="admin" go run ./tavern/
2022/03/08 05:46:06 no value found for environment var 'MYSQL_ADDR', starting tavern with SQLite
```


# User Interface

# CDN API

## Uploading Files
* File uploads require 2 form parameters: `fileName` and `fileContent`
* A successful response returns JSON with the following content: `{"data":{"file":{"id":<FILE_ID>}}}`

## Downloading Files
* TODO (CDN is not yet added to Tavern)

# GraphQL API

## Playground
If you'd like to explore the Graph API and try out some queries, head to the `/graphiql` endpoint of your tavern deployment. This endpoint exposes an interactive playground for you to experiment with GraphQL queries.

![/assets/img/tavern/graphiql.png](/assets/img/tavern/graphiql.png)


## Creating a New Model
1. Initialize the schema `cd tavern && go run entgo.io/ent/cmd/ent init <NAME>`
2. Update the generated file in `tavern/ent/schema/<NAME>.go`
3. Create a new [Relay-compatible](https://relay.dev/graphql/connections.htm) GraphQL schema in `tavern/graphql/schema/<NAME>.graphql`
3. Update `tavern/graphql/gqlgen.yml` to include the new GraphQL schema in the `schema:` list (e.g.`- schema/<NAME>`)
4. Update `tavern/graphql/gqlgen.yml` to include the ent types in the `autobind:` section (e.g.`- github.com/kcarretto/realm/tavern/ent/<NAME>`)
5. **Optionally** update the `models:` section of `tavern/graphql/gqlgen.yml` to bind any GraphQL enum types to their respective `entgo` generated types (e.g. `github.com/kcarretto/realm/tavern/ent/<NAME>.<ENUM_FIELD>`)
6. Run `go generate ./...`

## Adding Queries and Mutations
1. Add any queries to `tavern/graphql/schema/query.graphql` (e.g. `<NAME>s(after: Cursor, first: Int, before: Cursor, last: Int, orderBy: <NAME>Order, where: <NAME>WhereInput): <NAME>Connection`)
2. Add any mutations (and input type definitions) to `tavern/graphql/schema/mutation.graphql` (e.g. `create<NAME>(<NAME>: Create<NAME>Input!): <NAME>!`)
3. Run `go generate ./...`
4. Implement generated query and mutation resolver methods in `tavern/graphql/query.resolvers.go` and `tavern/graphql/mutation.resolvers.go`

## Code Generation
* After making a change, remember to run `go generate ./...` from the project root.
* `tavern/ent/schema` is a directory which defines our graph using database models (ents) and the relations between them.
* `tavern/ent/generate.go` is responsible for generating ents defined by the ent schema.
* `tavern/ent/entc.go` is responsible for generating code for the entgo <-> 99designs/gqlgen GraphQL integration.
* `tavern/graphql/schema/ent.graphql` is a GraphQL schema automatically generated by ent, providing useful types derived from our ent schemas.
* `tavern/graphql/schema/relay.graphql` is a GraphQL schema automatically generated by ent, providing useful types derived from our ent schemas.
* `tavern/graphql/schema/<NAME>.graphql` defines a GraphQL view of an entity and it's associated Relay types.
* `tavern/schema/query.graphql` is a GraphQL schema which defines our API's view of the graph, our ents and their relationships
* `tavern/schema/mutation.graphql` defines the mutations exposed by the GraphQL API.
* `tavern/generate.go` is responsible for using `github.com/99designs/gqlgen` to generate GraphQL code based on our ent Schema and the GraphQL schema.

## Resources
* [Relay Documentation](https://relay.dev/graphql/connections.htm)
* [entgo.io GraphQL Integration Docs](https://entgo.io/docs/graphql)
* [Example Ent + GraphQL project](https://github.com/ent/contrib/tree/master/entgql/internal/todo)
* [GQLGen Repo](https://github.com/99designs/gqlgen)