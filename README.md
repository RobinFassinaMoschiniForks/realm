# Realm

## API Documentation

### CDN

#### Upload
* File uploads require 2 form parameters: `fileName` and `fileContent`
* A successful response returns JSON with the following content: `{"data":{"file":{"id":<FILE_ID>}}}`

#### Download

## Graph Documentation

### Creating a new model
1. Initialize the schema `cd tavern && go run entgo.io/ent/cmd/ent init <NAME>`
2. Update the generated file in `tavern/ent/schema/<NAME>.go`
3. Create a new [Relay-compatible](https://relay.dev/graphql/connections.htm) GraphQL schema in `tavern/graphql/schema/<NAME>.graphql`
3. Update `tavern/graphql/gqlgen.yml` to include the new GraphQL schema in the `schema:` list (e.g.`- schema/<NAME>`)
4. Update `tavern/graphql/gqlgen.yml` to include the ent types in the `autobind:` section (e.g.`- github.com/kcarretto/realm/tavern/ent/<NAME>`)
5. **Optionally** update the `models:` section of `tavern/graphql/gqlgen.yml` to bind any GraphQL enum types to their respective `entgo` generated types (e.g. `github.com/kcarretto/realm/tavern/ent/<NAME>.<ENUM_FIELD>`)
6. Run `go generate ./...`

### Adding root queries and mutations
1. Add any queries to `tavern/graphql/schema/query.graphql` (e.g. `<NAME>s(after: Cursor, first: Int, before: Cursor, last: Int, orderBy: <NAME>Order, where: <NAME>WhereInput): <NAME>Connection`)
2. Add any mutations (and input type definitions) to `tavern/graphql/schema/mutation.graphql` (e.g. `create<NAME>(<NAME>: Create<NAME>Input!): <NAME>!`)
3. Run `go generate ./...`
4. Implement generated query and mutation resolver methods in `tavern/graphql/query.resolvers.go` and `tavern/graphql/mutation.resolvers.go`

### Code Generation
* After making a change, remember to run `go generate ./...` from the project root.
* `tavern/ent/schema` is a directory which defines our graph using database models (ents) and the relations between them.
* `tavern/ent/generate.go` is responsible for generating ents defined by the ent schema.
* `tavern/ent/entc.go` is responsible for generating code for the entgo <-> 99designs/gqlgen GraphQL integration.
* `tavern/graphql/schema/ent.graphql` is a GraphQL schema automatically generated by ent, providing useful types derived from our ent schemas.
* `tavern/graphql/schema/relay.graphql` is a GraphQL schema automatically generated by ent, providing useful types derived from our ent schemas.
* `tavern/graphql/schema/<NAME>.graphql` defines a GraphQL view of an entity and it's associated Relay types.
* `tavern/schema/query.graphql` is a GraphQL schema which defines our API's view of the graph, our ents and their relationships
* `tavern/schema/mutation.graphql` defines the mutations exposed by the GraphQL API.
* `tavern/generate.go` is responsible for using `github.com/99designs/gqlgen` to generate GraphQL code based on our ent Schema and the GraphQL schema.

### Resources
* [Relay Documentation](https://relay.dev/graphql/connections.htm)
* [entgo.io GraphQL Integration Docs](https://entgo.io/docs/graphql)
* [Example Ent + GraphQL project](https://github.com/ent/contrib/tree/master/entgql/internal/todo)
* [GQLGen Repo](https://github.com/99designs/gqlgen)